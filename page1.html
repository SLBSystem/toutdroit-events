<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TOUT DROIT ‚Äî Le r√©seau des entrepreneurs</title>

  <meta name="description" content="TOUT DROIT : √©v√©nements entrepreneurs au Havre. Brunchs, afterworks, ateliers et networking. Rejoins une communaut√© qui avance ‚Äî sans d√©tour."/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="icon" href="https://raw.githubusercontent.com/SLBSystem/toutdroit-events/main/favicon.png" />

  <style>
    :root{
      --blue:#0038FF;
      --ink:#111;
      --muted:#666;
      --bg:#f7f8fc;
      --card:#fff;
      --border:#eef0f5;
      --shadow:0 6px 20px rgba(0,0,0,.08);
      --radius:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink); background:var(--bg); line-height:1.6;
    }

    /* Header / Hero */
    .hero{
      background:#fff; border-bottom:1px solid var(--border);
    }
    .hero__inner{
      max-width:1100px; margin:0 auto; padding:32px 20px 24px; text-align:center;
    }
    .logo{
      width:96px; height:auto; border-radius:12px;
      box-shadow:0 10px 24px rgba(0,56,255,.18), 0 2px 6px rgba(0,0,0,.08);
      margin:8px auto 16px; display:block;
    }
    .title{
      font-size:clamp(24px, 3vw, 36px); font-weight:700; letter-spacing:.2px;
      color:var(--ink); margin-bottom:6px;
    }
    .subtitle{
      color:#2a2a2a; font-size:clamp(14px, 2vw, 16px);
    }
    .subtitle strong{ color:var(--blue); }

    /* Sections */
    .section{
      max-width:1100px; margin:28px auto; padding:0 20px;
    }
    .section__head{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom:14px;
    }
    .section__title{
      font-weight:700; font-size:clamp(18px, 2.2vw, 22px); color:var(--ink);
    }
    .section__hint{ color:var(--muted); font-size:14px; }

    /* Grids / Cards */
    .grid{
      display:grid; gap:16px;
      grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));
    }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:18px 16px; display:flex; flex-direction:column; gap:10px;
      transition:.25s transform, .25s box-shadow;
    }
    .card:hover{ transform:translateY(-4px); box-shadow:0 14px 28px rgba(0,0,0,.12); }
    .badge{
      display:inline-block; font-size:12px; font-weight:600; letter-spacing:.4px;
      padding:6px 10px; border-radius:999px; background:#eef2ff; color:var(--blue);
      width:max-content;
    }
    .card h3{
      font-size:18px; color:var(--blue); font-weight:700; line-height:1.35;
    }
    .meta{ color:#444; font-size:14px; }
    .meta b{ color:#222; }
    .desc{ color:#555; font-size:14px; }

    .cta{
      display:inline-block; width:max-content;
      background:var(--blue); color:#fff; text-decoration:none;
      font-weight:600; font-size:14px; padding:10px 14px; border-radius:999px;
      box-shadow:0 6px 16px rgba(0,56,255,.25); transition:.2s transform, .2s box-shadow;
    }
    .cta:hover{ transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,56,255,.28); }

    .ghost{
      display:inline-block; width:max-content;
      background:#f1f3ff; color:var(--blue); text-decoration:none;
      font-weight:600; font-size:14px; padding:10px 14px; border-radius:999px;
    }

    /* Detail */
    .detail{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:22px; margin-top:10px;
    }
    iframe{
      width:100%; height:clamp(420px, 70vh, 740px);
      border:none; border-radius:12px; margin-top:14px;
    }

    /* Empty / Error */
    .empty, .error{
      background:var(--card); border:1px dashed var(--border); border-radius:var(--radius);
      padding:26px; text-align:center; color:#333;
    }
    .empty p, .error p{ margin:8px 0 }
    .error{ border-style:solid; border-color:#ffd1d1; background:#fff6f6; color:#8b1a1a }

    /* Footer */
    footer{
      margin:40px auto 24px; text-align:center; color:#777; font-size:13px;
    }
    .social{
      margin-top:8px; display:flex; gap:10px; justify-content:center;
    }
    .social a img{
      width:18px; height:18px; vertical-align:middle;
      filter:invert(52%) sepia(0%) saturate(0%) hue-rotate(150deg) brightness(92%) contrast(90%);
      opacity:.75; transition:.2s opacity, .2s transform;
    }
    .social a:hover img{ opacity:.95; transform:translateY(-1px) }

    /* Utilities */
    .muted{ color:#777 }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center }
    .right{ margin-left:auto }

    @media (max-width:640px){
      .row.stack{ flex-direction:column; align-items:flex-start }
      .right{ margin-left:0 }
    }
  </style>
</head>
<body>

  <!-- HERO -->
  <header class="hero">
    <div class="hero__inner">
      <img class="logo" src="https://raw.githubusercontent.com/SLBSystem/toutdroit-events/main/logo-toutdroit.png" alt="TOUT DROIT">
      <h1 class="title">TOUT DROIT</h1>
      <p class="subtitle">Le r√©seau des entrepreneurs qui avancent ‚Äî <strong>sans d√©tour</strong>.</p>
    </div>
  </header>

  <!-- EN COURS -->
  <section class="section" id="liveSection" hidden>
    <div class="section__head row stack">
      <h2 class="section__title">En ce moment</h2>
      <span class="section__hint right">√âv√©nement en cours</span>
    </div>
    <div id="liveContainer" class="grid"></div>
  </section>

  <!-- PROCHAINS √âV√âNEMENTS -->
  <section class="section">
    <div class="section__head row stack">
      <h2 class="section__title">Prochains √©v√©nements</h2>
      <span class="section__hint right" id="countUpcoming"></span>
    </div>
    <div id="upcomingContainer" class="grid"></div>
    <div id="emptyUpcoming" class="empty" hidden>
      <h3>Aucun √©v√©nement ouvert pour le moment</h3>
      <p class="muted">On te pr√©pare des choses bien. En attendant, reste branch√©.</p>
      <div class="row" style="justify-content:center; margin-top:10px;">
        <a class="cta" href="https://www.instagram.com/toutdroit.td" target="_blank" rel="noopener">Suivre sur Instagram</a>
        <a class="ghost" href="#newsletter">√ätre pr√©venu</a>
      </div>
    </div>
  </section>

  <!-- D√âTAIL (quand eventID pr√©sent) -->
  <section class="section" id="detailSection" hidden>
    <div class="section__head">
      <h2 class="section__title" id="detailTitle">D√©tail</h2>
    </div>
    <div class="detail" id="detailCard"></div>
  </section>

  <!-- NEWSLETTER / TALLY -->
  <section class="section" id="newsletter">
    <div class="section__head row stack">
      <h2 class="section__title">Rester inform√©</h2>
      <span class="section__hint right">Z√©ro spam. Juste l‚Äôessentiel.</span>
    </div>
    <div class="card">
      <!-- Remplace l‚ÄôURL Tally par ta liste d‚Äôattente/newsletter -->
      <iframe src="https://tally.so/r/3jVL7a" title="S‚Äôinscrire pour √™tre pr√©venu" loading="lazy"></iframe>
    </div>
  </section>

  <!-- ERREUR GLOBALE -->
  <section class="section" id="errorSection" hidden>
    <div class="error">
      <h3>Oups</h3>
      <p>Erreur lors du chargement des √©v√©nements.</p>
      <p class="muted">R√©essaie plus tard ou contacte l‚Äô√©quipe.</p>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <p>¬© 2025 TOUT DROIT ‚Äî Le Havre</p>
    <div class="social">
      <a href="https://www.instagram.com/toutdroit.td" target="_blank" rel="noopener">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram">
      </a>
      <a href="https://www.linkedin.com/company/toutdroit" target="_blank" rel="noopener">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/linkedin.svg" alt="LinkedIn">
      </a>
      <a href="https://www.tiktok.com/@toutdroit" target="_blank" rel="noopener">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok">
      </a>
    </div>
  </footer>

  <script>
    const fmt = (d)=> new Intl.DateTimeFormat('fr-FR', { dateStyle:'full', timeStyle:'short' }).format(d);

    // Essaie d'obtenir un Date √† partir de l‚Äôobjet event
    function parseEventDate(e){
      // Priorit√©: champ ISO "start" / "end" si pr√©sent. Sinon tentative sur "date"
      const start = e.start ? new Date(e.start) : (e.date ? new Date(e.date) : null);
      const end   = e.end   ? new Date(e.end)   : null;
      return { start: isNaN(start) ? null : start, end: end && !isNaN(end) ? end : null };
    }

    function eventCard(id, e){
      const { start, end } = parseEventDate(e);
      const dateTxt = start ? fmt(start) : (e.date || '√Ä venir');
      const locTxt = e.location || 'Lieu √† d√©finir';
      const places = e.places || 'Inscriptions ouvertes';
      const type   = e.type || '√âv√©nement';
      const desc   = (e.description || 'Une rencontre conviviale entre entrepreneurs.').slice(0, 140);

      return `
        <a class="card" href='?eventID=${encodeURIComponent(id)}' aria-label="Voir l'√©v√©nement ${e.title || 'TOUT DROIT'}">
          <span class="badge">${type}</span>
          <h3>${e.title || '√âv√©nement TOUT DROIT'}</h3>
          <p class="meta"><b>üìÖ</b> ${dateTxt}</p>
          <p class="meta"><b>üìç</b> ${locTxt}</p>
          <p class="meta"><b>üë•</b> ${places}</p>
          <p class="desc">${desc}...</p>
          <span class="cta" style="margin-top:6px;">Je participe ‚Üí</span>
        </a>
      `;
    }

    function liveCard(id, e){
      const { start, end } = parseEventDate(e);
      const endTxt   = end ? fmt(end) : 'bient√¥t';
      const locTxt   = e.location || 'Lieu √† d√©finir';
      const type     = e.type || '√âv√©nement';

      return `
        <div class="card">
          <span class="badge">En cours</span>
          <h3>${e.title || '√âv√©nement TOUT DROIT'}</h3>
          <p class="meta"><b>‚è±Ô∏è</b> Jusqu‚Äô√† ${endTxt}</p>
          <p class="meta"><b>üìç</b> ${locTxt}</p>
          <p class="desc">${(e.description || '').slice(0, 220)}...</p>
          <div class="row" style="margin-top:6px;">
            <a class="cta" href='?eventID=${encodeURIComponent(id)}'>Voir le d√©tail</a>
            <a class="ghost" href="https://www.instagram.com/toutdroit.td" target="_blank" rel="noopener">Stories en direct</a>
          </div>
        </div>
      `;
    }

    function detailBlock(e){
      const { start, end } = parseEventDate(e);
      const dateTxt = start ? fmt(start) : (e.date || '‚Äî');
      const locTxt  = e.location || '‚Äî';
      const places  = e.places || '‚Äî';
      const type    = e.type || '‚Äî';
      const desc    = e.description || '';

      return `
        <h2 style="margin-bottom:4px">${e.title || '√âv√©nement TOUT DROIT'}</h2>
        <p class="muted" style="margin-bottom:12px">${type}</p>
        <div class="row stack" style="margin-bottom:12px">
          <span class="meta"><b>Date :</b> ${dateTxt}</span>
          <span class="meta"><b>Lieu :</b> ${locTxt}</span>
          <span class="meta"><b>Places :</b> ${places}</span>
        </div>
        <p style="margin-bottom:8px">${desc}</p>
        ${e.tally ? `<iframe src="${e.tally}" title="Inscription" loading="lazy"></iframe>` : `
          <div class="empty" style="margin-top:10px">
            <h3>Les inscriptions ouvriront bient√¥t</h3>
            <p class="muted">Suis-nous pour √™tre pr√©venu d√®s l‚Äôouverture.</p>
            <a class="cta" href="https://www.instagram.com/toutdroit.td" target="_blank" rel="noopener">Instagram</a>
          </div>
        `}
      `;
    }

    async function load(){
      const contentUpcoming = document.getElementById('upcomingContainer');
      const emptyUpcoming   = document.getElementById('emptyUpcoming');
      const countUpcoming   = document.getElementById('countUpcoming');
      const liveSection     = document.getElementById('liveSection');
      const liveContainer   = document.getElementById('liveContainer');
      const detailSection   = document.getElementById('detailSection');
      const detailCard      = document.getElementById('detailCard');
      const errorSection    = document.getElementById('errorSection');

      // loading states
      contentUpcoming.innerHTML = `<div class="card"><p class="muted">Chargement des √©v√©nements‚Ä¶</p></div>`;

      const qs = new URLSearchParams(location.search);
      const eventID = qs.get('eventID');

      try{
        const res = await fetch('./events.json');
        if(!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json();

        const entries = Object.entries(data || {});
        const now = new Date();

        // compute statuses
        const enriched = entries.map(([id, e])=>{
          const { start, end } = parseEventDate(e);
          const status =
            start && end && now >= start && now <= end ? 'live' :
            start && now < start ? 'upcoming' :
            start && end && now > end ? 'past' :
            'unknown';
          return { id, e, start, end, status };
        });

        // Live
        const live = enriched.filter(x=>x.status==='live');
        if(live.length){
          liveSection.hidden = false;
          liveContainer.innerHTML = live.map(x=>liveCard(x.id, x.e)).join('');
        }

        // Upcoming sorted
        const upcoming = enriched
          .filter(x=>x.status==='upcoming')
          .sort((a,b)=>(a.start||0)-(b.start||0));

        countUpcoming.textContent = upcoming.length ? `${upcoming.length} √† venir` : '';
        if(upcoming.length){
          contentUpcoming.innerHTML = upcoming.map(x=>eventCard(x.id, x.e)).join('');
          emptyUpcoming.hidden = true;
        }else{
          contentUpcoming.innerHTML = '';
          emptyUpcoming.hidden = false;
        }

        // Detail page
        if(eventID){
          const found = enriched.find(x=>x.id === eventID);
          detailSection.hidden = false;
          if(found){
            document.title = `${found.e.title || '√âv√©nement'} ‚Äî TOUT DROIT`;
            detailCard.innerHTML = detailBlock(found.e);
          }else{
            detailCard.innerHTML = `<div class="error"><h3>√âv√©nement introuvable</h3><p>Le lien n‚Äôest plus valide ou l‚Äô√©v√©nement n‚Äôexiste pas.</p></div>`;
          }
        }

      }catch(err){
        console.error(err);
        errorSection.hidden = false;
        contentUpcoming.innerHTML = '';
        emptyUpcoming.hidden = true;
      }
    }

    load();
  </script>
</body>
</html>
