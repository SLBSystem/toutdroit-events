<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TOUT DROIT — Réseau & Événements</title>

  <meta name="description" content="TOUT DROIT : réseau d'entrepreneurs au Havre. Prochains événements, rencontres, brunchs, ateliers, afterworks. Rejoins le mouvement." />

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="icon" href="https://raw.githubusercontent.com/SLBSystem/toutdroit-events/main/favicon.png" />

  <style>
    :root{
      --blue:#0038FF;
      --text:#111;
      --muted:#666;
      --bg:#fafbff;
      --card:#fff;
      --border:#eef2ff;
      --shadow:0 10px 30px rgba(0,0,0,.06);
      --radius:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,-apple-system,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    header{padding:28px 0 8px;text-align:center;}
    header .brand{
      display:flex;gap:14px;align-items:center;justify-content:center;margin-bottom:10px;
    }
    .brand img{width:80px;height:auto;border-radius:10px;box-shadow:0 6px 15px rgba(0,56,255,.18),0 2px 4px rgba(0,0,0,.08)}
    .brand h1{font-size:28px;letter-spacing:.2px}
    .tagline{color:var(--muted);font-size:14px}
    .hero{
      margin:18px auto 28px;background:linear-gradient(180deg,#fff, #f5f7ff);
      border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:28px;text-align:center;
    }
    .hero h2{font-size:24px;margin-bottom:8px;color:var(--blue)}
    .hero p{color:#333;line-height:1.6}
    .hero .cta{
      display:inline-block;margin-top:16px;background:var(--blue);color:#fff;text-decoration:none;
      padding:10px 16px;border-radius:999px;font-weight:600;box-shadow:0 6px 16px rgba(0,56,255,.25);
    }
    /* Sections */
    .section{margin:34px 0}
    .section h3{font-size:20px;margin-bottom:12px}
    .hint{color:var(--muted);font-size:14px;margin-bottom:12px}

    /* Featured event */
    .featured{
      display:grid;grid-template-columns:1.2fr .8fr;gap:18px;align-items:center;
      background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;
    }
    .featured .badge{
      display:inline-block;background:#eef2ff;color:#1f2cff;font-weight:600;font-size:12px;
      padding:6px 10px;border-radius:999px;margin-bottom:10px;
    }
    .featured h4{font-size:22px;margin:2px 0 8px;color:var(--blue)}
    .meta{color:#444;font-size:14px;display:flex;gap:14px;flex-wrap:wrap;margin:6px 0 10px}
    .meta span{display:inline-flex;gap:6px;align-items:center}
    .desc{color:#333;line-height:1.6;font-size:15px}
    .actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .btn{
      display:inline-block;text-decoration:none;padding:10px 14px;border-radius:10px;font-weight:600;font-size:14px;
      border:1px solid #dbe3ff;background:#fff;
    }
    .btn.primary{background:var(--blue);color:#fff;border-color:var(--blue)}
    .illustration{
      background:linear-gradient(180deg,#eef2ff,#fff);border-radius:12px;border:1px solid var(--border);
      min-height:180px;display:flex;align-items:center;justify-content:center;color:#3a47ff;font-weight:600;
    }

    /* Grid events */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:var(--shadow);
      display:flex;flex-direction:column;gap:8px
    }
    .card .type{font-size:12px;background:#eef2ff;color:#1f2cff;display:inline-block;padding:4px 8px;border-radius:999px;font-weight:600}
    .card h5{font-size:16px;color:var(--blue)}
    .card .small{color:#444;font-size:14px}
    .card .cta{align-self:flex-start;margin-top:8px;background:var(--blue);color:#fff;text-decoration:none;padding:8px 12px;border-radius:10px;font-weight:600;font-size:14px}

    /* Empty states */
    .empty{
      background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:26px;text-align:center;color:#333
    }
    .empty p{margin-top:6px}
    .empty .mini-cta{display:inline-block;margin-top:12px;text-decoration:none;color:#fff;background:var(--blue);padding:8px 12px;border-radius:999px;font-weight:600}

    /* Past events */
    details.past{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:14px}
    details.past summary{cursor:pointer;font-weight:700}
    .past-list{margin-top:14px;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .past-item{background:#f7f8ff;border:1px dashed #dbe3ff;border-radius:10px;padding:10px}
    .past-item .small{font-size:13px;color:#555}

    footer{
      margin:40px 0 26px;text-align:center;color:#777;font-size:13px
    }
    .social a{display:inline-block;margin:0 6px;text-decoration:none;opacity:.7}
    .social a:hover{opacity:1}
    @media(max-width:900px){ .featured{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <img src="https://raw.githubusercontent.com/SLBSystem/toutdroit-events/main/logo-toutdroit.png" alt="Logo TOUT DROIT">
        <h1>TOUT DROIT</h1>
      </div>
      <p class="tagline">Le réseau des entrepreneurs qui avancent — sans détour.</p>
    </header>

    <section class="hero">
      <h2>Rencontres, projets, opportunités</h2>
      <p>Brunchs, talks, afterworks, ateliers. Des événements concrets pour connecter, apprendre et faire grandir ton business.</p>
      <a class="cta" href="https://www.instagram.com/toutdroit.td" target="_blank" rel="noopener">Suivre sur Instagram</a>
    </section>

    <!-- Featured / Ongoing -->
    <section class="section" id="section-featured" hidden>
      <h3>À l’affiche</h3>
      <div id="featured" class="featured" aria-live="polite"></div>
    </section>

    <!-- Upcoming -->
    <section class="section">
      <h3>Prochains événements</h3>
      <p class="hint">Inscris-toi dès maintenant. Les places partent vite quand c’est utile.</p>
      <div id="upcoming" class="grid"></div>
      <div id="upcoming-empty" class="empty" hidden>
        <h4>Pas d’événement à venir (pour l’instant)</h4>
        <p>On prépare la suite. Suis-nous pour être prévenu en premier.</p>
        <a href="https://www.instagram.com/toutdroit.td" class="mini-cta" target="_blank" rel="noopener">Instagram TOUT DROIT</a>
      </div>
    </section>

    <!-- Past -->
    <section class="section" id="section-past" hidden>
      <details class="past">
        <summary>Événements passés</summary>
        <div id="past" class="past-list"></div>
      </details>
    </section>

    <footer>
      <div>© TOUT DROIT — Le Havre</div>
      <div class="social" style="margin-top:8px;">
        <a href="https://www.instagram.com/toutdroit.td" target="_blank" rel="noopener" aria-label="Instagram">
          <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" width="18" height="18" style="filter:invert(55%) sepia(0%) saturate(0%) hue-rotate(150deg) brightness(92%) contrast(90%);">
        </a>
        <a href="https://www.linkedin.com/company/toutdroit" target="_blank" rel="noopener" aria-label="LinkedIn">
          <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/linkedin.svg" width="18" height="18" style="filter:invert(55%) sepia(0%) saturate(0%) hue-rotate(150deg) brightness(92%) contrast(90%);">
        </a>
        <a href="https://www.tiktok.com/@toutdroit" target="_blank" rel="noopener" aria-label="TikTok">
          <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" width="18" height="18" style="filter:invert(55%) sepia(0%) saturate(0%) hue-rotate(150deg) brightness(92%) contrast(90%);">
        </a>
      </div>
    </footer>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    const fmtDate = iso => {
      try{
        if(!iso) return 'À venir';
        const d = new Date(iso);
        return d.toLocaleString('fr-FR', { weekday:'short', day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit' }).replace('.', '');
      }catch{ return iso; }
    };

    const now = () => new Date();

    // On tolère différents schémas: start/end ou date seule
    const getStart = e => e.start ? new Date(e.start) : (e.date ? new Date(e.date) : null);
    const getEnd   = e => e.end   ? new Date(e.end)   : (e.start ? new Date(e.start) : (e.date ? new Date(e.date) : null));

    async function main(){
      const contentUpcoming = $('#upcoming');
      const emptyUpcoming = $('#upcoming-empty');
      const featuredWrap = $('#featured');
      const sectionFeatured = $('#section-featured');
      const pastWrap = $('#past');
      const sectionPast = $('#section-past');

      // Loading minimal
      contentUpcoming.innerHTML = `<div class="hint">Chargement…</div>`;

      let data;
      try{
        const res = await fetch('./events.json', { cache: 'no-store' });
        if(!res.ok) throw new Error('HTTP '+res.status);
        data = await res.json();
      }catch(err){
        contentUpcoming.innerHTML = `<div class="empty"><h4>Impossible de charger les événements</h4><p>Réessaie plus tard.</p></div>`;
        console.error(err);
        return;
      }

      // Support: object {id: event} ou array [event]
      const list = Array.isArray(data) ? data : Object.entries(data).map(([id, e]) => ({ id, ...e }));

      // Normalisation + tri
      const withDates = list.map(ev => {
        const s = getStart(ev);
        const e = getEnd(ev);
        return { ...ev, _start:s, _end:e };
      });

      const nowDate = now();
      const upcoming = withDates
        .filter(ev => ev._start && ev._start >= nowDate)
        .sort((a,b) => a._start - b._start);

      const ongoing = withDates
        .filter(ev => ev._start && ev._end && ev._start <= nowDate && ev._end >= nowDate)
        .sort((a,b) => a._end - b._end);

      const past = withDates
        .filter(ev => ev._end ? ev._end < nowDate : (ev._start ? ev._start < nowDate : false))
        .sort((a,b) => b._start - a._start)
        .slice(0,8);

      // Featured = en cours sinon prochain
      let featured = ongoing[0] || upcoming[0] || null;

      // RENDER FEATURED
      if(featured){
        sectionFeatured.hidden = false;
        const when = featured._start && featured._end
          ? `${fmtDate(featured._start)} → ${fmtDate(featured._end)}`
          : fmtDate(featured._start || featured.date);

        featuredWrap.innerHTML = `
          <div>
            <span class="badge">${ongoing.length ? 'En cours' : 'À venir'}</span>
            <h4>${featured.title || 'Événement TOUT DROIT'}</h4>
            <div class="meta">
              <span>📅 ${when}</span>
              <span>📍 ${featured.location || '—'}</span>
              ${featured.places ? `<span>👥 ${featured.places}</span>` : ''}
              ${featured.type ? `<span>🏷️ ${featured.type}</span>` : ''}
            </div>
            <p class="desc">${featured.description || ''}</p>
            <div class="actions">
              ${featured.tally ? `<a class="btn primary" href="${featured.tally}" target="_blank" rel="noopener">S’inscrire</a>` : ''}
              <a class="btn" href="?eventID=${encodeURIComponent(featured.id || '')}">Détails</a>
            </div>
          </div>
          <div class="illustration">TOUT DROIT — Réseau</div>
        `;
      }

      // RENDER UPCOMING GRID
      if(upcoming.length){
        contentUpcoming.innerHTML = upcoming.map(e => `
          <article class="card">
            <span class="type">${e.type || 'Réseautage'}</span>
            <h5>${e.title || 'Événement'}</h5>
            <div class="small">📅 ${fmtDate(e._start || e.date)}</div>
            <div class="small">📍 ${e.location || '—'}</div>
            ${e.places ? `<div class="small">👥 ${e.places}</div>` : ''}
            <a class="cta" href="${e.tally ? e.tally : `?eventID=${encodeURIComponent(e.id || '')}`}" ${e.tally ? 'target="_blank" rel="noopener"' : ''}>
              ${e.tally ? 'Je m’inscris' : 'Détails'}
            </a>
          </article>
        `).join('');
      }else{
        contentUpcoming.innerHTML = '';
        emptyUpcoming.hidden = false;
      }

      // RENDER PAST
      if(past.length){
        sectionPast.hidden = false;
        pastWrap.innerHTML = past.map(e => `
          <div class="past-item">
            <div class="small">📅 ${fmtDate(e._start || e.date)}</div>
            <div class="small">🧾 ${e.title || 'Événement'}</div>
            <div class="small">📍 ${e.location || '—'}</div>
          </div>
        `).join('');
      }
    }

    main();
  </script>
</body>
</html>
